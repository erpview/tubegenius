[phases.setup]
nixPkgs = ["nodejs_20", "python311", "ffmpeg", "python311Packages.pip"]

[phases.install]
cmds = [
  "echo '=== Installing server dependencies ==='",
  "npm install --prefix server",
  "echo '=== Installing latest yt-dlp ==='",
  "pip install --break-system-packages -U yt-dlp",
  "echo '=== Verifying yt-dlp installation ==='",
  "which yt-dlp || echo 'yt-dlp not in PATH'",
  "python3 -m yt_dlp --version || echo 'yt-dlp module check failed'",
  "ls -la server/"
]

[start]
cmd = "export PATH=$HOME/.local/bin:$PATH && cd server && echo 'Starting server...' && node server.js"
